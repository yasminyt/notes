## 可达性 Reachability
+ js 的内存管理中的一个重要概念就是 可达性
+ “可达”值表示的是以某种方式可访问或可使用的值，它们保证存储在内存中
1. 有一组基本的固有可达值，由于显而易见的原因而无法删除
   - 当前函数的局部变量和参数
   - 当前嵌套调用链上（闭包）其它函数的变量和参数
   - 全局变量
   - 还有一些其它内部的   
这些值都被称作为 根 *"root"*
2. 如果可以通过引用或引用链从根访问，则认为任何其它值都是可达的
+ js 引擎中的垃圾回收机制，就是监控所有的对象，并且移除已经不可达的对象

## A simple example
+ 有以下代码：
  ```javascript
  let user = {   // user 有一个指向 object 的引用
    name: 'John'
  }
  ```
+ 以上代码对应的内存结构：

  - 箭头指向了对一个对象的引用
  - 全局变量 `user` 指向了这个对象 `{ name: 'John' }`
  - 由于 `name` 属性存储的是基本类型的数据，所以被绘制在了这个对象内部
+ 如果重新给 `user` 赋值，那么对对象的引用就会丢失
  ```javascript
  user = null
  ```
+ 重新赋值后对应的内存结构如下图所示：

  - 现在对象 `{ name: 'John' }` 已经变成了不可达，并且没有任何其它方式访问它，垃圾回收机制就会丢失该数据并释放内存
+ 如果一开始的时候将 `user` 的引用复制给了 `admin`
  ```javascript
  let admin = user
  ```
+ 则有两个引用指向了同一个对象，对应的内存结构为：

+ 此时再令 `user = null`，对象仍然是可达的，因为可以通过另一个全局变量 `admin` 进行访问，所以该对象会仍然在内存中，如果 `admin` 也被重新赋值了，那么这个对象就会被垃圾回收机制给收走了

## 相互关联的对象
+ 在相互关联的对象中，相比于上述的例子要稍微复杂：
  ```javascript
  function marry(man, women) {
    woman.husband = man
    man.wife = woman

    return {
      father: man,
      mother: woman
    }
  }

  let family = marry({ name: 'John' }, { name: 'Ann' })
  ```
+ 上述代码对应的内存结构图如下：

+ 当删除了其中的两个引用关系之后：
  ```javascript
  delete family.father
  delete family.mother.husband
  ```
  对应的内存结构图如下：

  - 从结构图中可以看到，即便删除了这两个引用，所有对象仍然可以访问
  - `{ name: 'John' }` 这个对象即便已经没有任何变量可以访问到它，但是因为它存在着对可达访问对象的引用，所以不会被垃圾回收机制回收
+ 如果再将 `{ name: 'John' }` 这个对象的引用进行删除（当然这在程序中是没办法做到的，所以这是不被使用又占用内存的坏数据），如下结构所示，则 `{ name: 'John' }` 会被垃圾回收机制回收

## 无法可达的孤岛
+ 在上例中，如果对 `family` 变量重新赋值：`family = null`，则新的内存结构如下所示：

+ 尽管 `{ name: 'John' }` 和 `{ name: 'Ann' }` 之间仍有联系，但是 `family` 对象已经从根上断开，而不再有对这两个对象的引用，这两个对象会成为孤岛而被垃圾回收机制回收

## 基本的垃圾回收机制算法
+ 基本的垃圾回收机制算法为：“标记 —— 清除”
+ 定期执行以下“垃圾收集“步骤：
  + 垃圾收集获取 roots，并且标记（记住）它们
  + 然后访问并标记它们的所有引用
  + 然后访问标记的对象并标记其引用。记住所有访问过的对象，以便将来两次不访问同一对象
  + 依此类推，直到有未经访问的引用（可以从根处进行访问的）
  + 删除除标记以外的所有对象
+ 以上步骤可以由以下结构图进行说明：
  + 有以下的对象结构：

  + 可以看到右侧有一个“无法可达的孤岛”。以下结构图说明了垃圾回收机制是如何对其进行处理的：
  1. 先标记 root

  2. 然后标记 root 对应的引用

  3. 尽可能地标记所有引用对应的引用

  4. 最后，在此过程中无法访问的对象被视为无法访问，将被删除


### See more：[Garbage collection](https://javascript.info/garbage-collection)